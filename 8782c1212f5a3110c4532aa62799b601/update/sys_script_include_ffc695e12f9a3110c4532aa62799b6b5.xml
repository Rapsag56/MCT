<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>true</active>
        <api_name>x_744286_mct.SomaPercentual</api_name>
        <caller_access/>
        <client_callable>true</client_callable>
        <description/>
        <name>SomaPercentual</name>
        <script><![CDATA[var SomaPercentual = Class.create();
SomaPercentual.prototype = Object.extendsObject(global.AbstractAjaxProcessor, {
    verificaSomaPercentual: function() {
        var cod_cargo = this.getParameter('sysparm_cod_cargo');
        var cod_gr_desp = this.getParameter('sysparm_cod_gr_desp');
        var numeroContrato = this.getParameter('sysparm_numero_contrato');
        var cod_recurso = this.getParameter('sysparm_cod_recurso');
        var cod_pbms = this.getParameter('sysparm_cod_pbms');
        var currentPercentual = parseFloat(this.getParameter('sysparm_current_percentual'));

        var ga = new GlideAggregate('x_744286_mct_tabela_ovh_recurso');
        ga.addEncodedQuery("codigo_do_cargo=" + cod_cargo + "^codigo_do_grupo_de_despesa=" + cod_gr_desp + "^numero_do_contrato=" + numeroContrato + "^codigo_recurso=" + cod_recurso + "^codigo_do_pbms=" + cod_pbms);
        ga.addAggregate('SUM', 'percentual');
        ga.query();

        var soma = 0;

        while (ga.next()) {
            var percentual = parseFloat(ga.getAggregate('SUM', 'percentual'));

            if (!isNaN(percentual)) {
                soma += percentual;
            }
        }

        // Retornar a soma e o percentual atual para o cliente script
        this.setParameter('answer', soma.toString());
        this.setParameter('currentPercentual', currentPercentual.toString());
    },

    type: 'SomaPercentual'
});
]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2023-11-04 03:02:08</sys_created_on>
        <sys_id>ffc695e12f9a3110c4532aa62799b6b5</sys_id>
        <sys_mod_count>6</sys_mod_count>
        <sys_name>SomaPercentual</sys_name>
        <sys_package display_value="MCT" source="x_744286_mct">8782c1212f5a3110c4532aa62799b601</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="MCT">8782c1212f5a3110c4532aa62799b601</sys_scope>
        <sys_update_name>sys_script_include_ffc695e12f9a3110c4532aa62799b6b5</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2023-11-04 04:41:54</sys_updated_on>
    </sys_script_include>
</record_update>
